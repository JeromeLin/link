import requests
import pandas as pd
from bs4 import BeautifulSoup

codes = [123166, 128053, 123018, 127004, 128034, 113651, 123015, 110043, 113047, 128048, 113516, 113062, 127025, 113050, 132018, 128091, 110079, 127055, 123002, 113055, 127032, 111000, 113625, 113057, 128029, 128122, 110044, 127027, 110083, 127045, 123025, 127060, 110053, 123136, 127022, 123108, 132014, 113650, 110070, 110064, 113631, 110077, 128125, 128129, 127067, 113524, 128044, 110080, 110057, 127014, 113052, 128074, 110061, 128114, 113655, 110060, 110087, 113024, 128134, 132026, 127049, 128132, 128030, 110055, 127015, 128049, 128014, 110063, 123154, 127018, 113519, 127017, 128037, 113632, 110084, 127012, 127006, 110047, 128127, 128119, 128083, 123131, 113656, 113013, 127029, 113046, 113021, 110045, 128124, 123122, 113545, 113044, 127047, 123128, 123065, 113048, 127042, 127061, 110075, 128133, 110062, 127054, 127020, 123107, 113060, 128106, 127056, 113578, 113623, 113054, 128105, 127053, 127021, 113595, 113056, 127007, 123142, 123004, 118005, 113594, 128023, 123146, 113639, 113033, 113011, 127033, 123014, 113605, 123056, 113648, 110081, 128118, 127024, 110067, 128071, 113606, 113588, 113043, 128116, 113659, 127035, 123048, 123104, 113037, 123093, 113589, 113563, 128128, 127069, 113573, 113058, 128108, 127063, 127005, 123147, 123035, 113609, 113027, 110058, 110072, 123115, 113017, 123103, 120002, 110048, 128130, 128100, 123091, 123011, 110073, 128138, 127039, 123153, 123076, 113658, 113624, 127044, 113596, 113584, 123113, 128062, 128022, 113565, 123130, 113574, 113569, 111005, 123163, 113634, 128121, 128015, 123096, 113636, 128131, 118011, 113643, 128036, 111001, 128063, 123106, 123072, 118006, 113638, 113591, 132015, 128035, 123145, 113602, 132022, 128123, 128120, 127076, 123149, 123092, 123162, 113575, 113059, 110059, 123049, 123133, 113616, 110088, 128097, 118023, 110086, 127031, 113600, 113641, 113042, 123127, 113637, 113633,
         128143, 127041, 123126, 128136, 128066, 127034, 123044, 123158, 127052, 123155, 128026, 123082, 113535, 127026, 123010, 113604, 113597, 110089, 123039, 113628, 128142, 128135, 113652, 113608, 128085, 128072, 123123, 113593, 123050, 113640, 113577, 128075, 128087, 127062, 127051, 123117, 118007, 118004, 123157, 123124, 113526, 113505, 123138, 113576, 113527, 123099, 113619, 128090, 123063, 113570, 113532, 123160, 113053, 113045, 113561, 113049, 113579, 113622, 127016, 118003, 127071, 127064, 113566, 123059, 113549, 123119, 113627, 113039, 127075, 113542, 128017, 132021, 123090, 118008, 113030, 128081, 127068, 118016, 123075, 123022, 110085, 127074, 123031, 123077, 118018, 118013, 123054, 113610, 128042, 123100, 118025, 113657, 123116, 111003, 111002, 123132, 118000, 118022, 118015, 113546, 127046, 123061, 113644, 110082, 110052, 127043, 123150, 128117, 127059, 118017, 118012, 110076, 127040, 123078, 118021, 127030, 127028, 127019, 127050, 128140, 128056, 128039, 123105, 123159, 113647, 113653, 113530, 123152, 123046, 128141, 128076, 113063, 123109, 123013, 118020, 110068, 128041, 123129, 118014, 113618, 127070, 127038, 123080, 113646, 113025, 123088, 123087, 123071, 123052, 110074, 128021, 123038, 127036, 113629, 123101, 123165, 113567, 127066, 123140, 128144, 113654, 123034, 123141, 118010, 113525, 111004, 128137, 128033, 123120, 118026, 118009, 118024, 113621, 123089, 128078, 113061, 113615, 123161, 123164, 123098, 128082, 127058, 123134, 128101, 123114, 127073, 127072, 123125, 111006, 110090, 123144, 123112, 128145, 113601, 132020, 128095, 128109, 127065, 113626, 113585, 123156, 128111, 113504, 123064, 111007, 123151, 113534, 113016, 123067, 128040, 123118, 123143, 123121, 123083, 127037, 113537, 123139, 127057, 113582, 118019, 123060, 128070, 113598, 123148, 123085, 113649, 128069, 123012, 123135, 110056, 123057, 128025, 128079]


def gg(code):
    url = "https://basic.10jqka.com.cn/32/{}/detail.html".format(code)
    print(url)
    res = requests.get(
        url, headers={"User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36"}).text

    soup = BeautifulSoup(res, 'lxml')

    tables = soup.find('table').find('tbody')
    trs = tables.find_all('tr')

    name = soup.find('h1')

    data = []
    for i in trs:
        row = [code, name.text]
        for k in i.find_all("td"):
            row.append(k.text)
        data.append(row)

    return data


d = []
for code in codes:
    try:
        d += gg(code)
    except:
        print(code)

df = pd.DataFrame(d, columns=[
                  '代码', '代码', '持有人名称', '持有人标识', '持有数量', '持有比例'])
# print(df)
df.to_csv('bond.csv')
